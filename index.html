#!/bin/sh

set -ex

SUDO="$(command -v sudo || true) "
CONTAINER=$(grep -q docker /proc/self/cgroup && echo "true" || true)

setup() {
  if [ ! -e "$SCRIPTS"/"$1" ]
  then
    get "$INSTALLER/$1" "$SCRIPTS/$1" || get "common/$1" "$SCRIPTS/$1"
    . "$SCRIPTS/$1"
  fi
}

install() {
  case $INSTALLER in
    apt)
      sudo apt install -y $@
      ;;
    dnf)
      sudo dnf install -y $@
      ;;
    pacman)
      sudo pacman -S --noconfirm $@
      ;;
  esac
}

get() {
  curl -sfS "https://raw.githubusercontent.com/Funk66/installer/master/$1" -o "$2" --create-dirs 2> /dev/null
}

available() {
  command -v "$1" > /dev/null 2>&1
}

sudo() {
  ${SUDO}$@
}

for INSTALLER in apt dnf pacman
do
  available $INSTALLER && break
done

if [ -z $INSTALLER ]
then
  echo "‚ùå Unable to recognize OS"
  exit 1
fi

SCRIPTS=$(mktemp -d)

while [ $# -gt 0 ]
do
  setup "$1"
  shift 1
done

rm -r "$SCRIPTS"
echo "Done"
